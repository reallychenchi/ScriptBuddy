# ScriptBuddy 台词本项目

## 概述

这是一个用来帮助用户背台词的项目，用到语音识别转文字、文字转语音功能。
具备面向用户的前端和面向管理的后端。此次需求只讨论前端，前端需要具备转向客户端的能力。

## 需求

首先实现网页版本，目前只要求中文版本，但是要支持国际化能力，保留多语言支持。
颜色要使用配置/主题控制，方便后续更改主题色。

用户联系台词，app/网页 是 陪练

### 启动与权限检查
应用启动时，首先自动检查必要权限（麦克风）和设备状态（音量）。
*   **权限/状态检查**：
    *   检测麦克风权限，如果没有，在界面展示提示，点击后跳转到权限设置。
    *   检测系统音量是否足够大，如果没有，在界面展示提示，实时监听（是否可以做到？网页做不到，那么只做告知即可）。
    *   
*   **交互**：
    *   如果权限缺失或音量过低，在界面上用**大号字体**醒目提示用户。
    *   用户解决后，或者有了足够的权限的时候，自动进入下一步，尽量减少点击操作。
    *   当系统的音量不够大的时候，或者发现没有录音权限的时候，回到检查权限界面。
    *   打开界面的时候就向服务端请求数据，如果进入下一步的时候还没有完成请求，展示进度条，请求失败，展示通用失败/重试提示。有了足够的数据开始进入下一步。

### 界面布局
*   **手机竖屏**：上部为台词区域，下部为语音区域。
*   **手机横屏/平板**：左侧为台词区域，右侧为语音区域。

#### 台词区域（UI展示）
*   **内容类型**：
    *   **询问/交互提示**：用 **红色** 文字展示（如“请问您此时想扮演甲还是乙？”）。
    *   **系统反馈**：用 **深绿色** 文字展示。
    *   **用户台词**：根据熟练度显示不同颜色。
        *   初学（Level 1）：**黑色**（全显）。
        *   熟练（Level 2）：**灰色**（半隐）。
        *   默背（Level 3）：**白色**（不可见，同背景色）。
    *   **陪练台词**：
        *   正常：**深蓝色**。
        *   默背模式：**白色**（不可见）。
*   **背景色**：白色。
*   **字体**：大号，易读。
*   **滚动逻辑**：
    *   交互/询问内容：全量展示，自动适配长度。
    *   用户台词：按语速逐段展示，检测到用户说完（或匹配成功）后自动替换下一段。
    *   陪练台词：显示一段，TTS播报完后自动替换。

#### 语音区域（动画反馈）
展示 Lottie 动画，反映当前状态：
*   **正在说话**（陪练询问、陪练念台词）：展示“说话中”动画。
*   **等待聆听**（等待用户回答、等待用户念台词）：展示“聆听/等待”动画。

### 核心交互流程（Voice-First）
原则：**尽量无触控，全语音交互**。

#### 1. 角色选择
*   进入台词界面前，不使用弹窗。
*   或者是 在阶段2 意图识别发现用户希望切换难度
* 
*   **App提问**：“请通过语音告诉我，您想扮演‘甲’还是‘乙’？”
*   **用户回答**：（如“我想演甲”、“我是乙”）。
*   **处理**：录音 -> STT转文字 -> LLM语义分析 -> 确定角色 -> 开始对戏。

#### 2. 台词对练 & 翻页逻辑
*   **陪练念**：播放TTS，动画展示“说话中”，播完自动触发用户回合。
*   **用户念**：动画展示“聆听中”，进行语音识别。识别出来文字以后，完成一句话，就提交大模型，判断用户是否有：1、停止；2、重新开始；3、改变难度级别；4、角色选择 三种意图，如果存在三种意图，中断台词对练，来到对应流程。
*   **过关判定**：
    *   初期策略：检测到用户**说话结束**（VAD断句）即视为完成，自动进入下一句。
    *   后期优化：STT识别内容与台词**匹配度达标**才视为完成。

#### 3. 难度（熟练度）自适应切换
*   **触发条件**：
    *   用户通过“过关判定”累计达到 **5遍**。
    *   或者是 语音识别精准匹配成功。
    *   或者是 在阶段2 意图识别发现用户希望切换难度
*   **App主动询问**：“您似乎记熟了，是否将台词颜色变浅（变灰/变白）以增加难度？”
*   **用户回答**：（如“好的”、“不用了”、“试试看”）。
*   **处理**：STT -> LLM分析意图 -> 调整UI颜色的Level状态。

#### 4. 停止
*   **触发条件**：
    *   在阶段2 意图识别发现用户希望停止
*   **App开始向用户询问** 您确认希望退出吗？
*   **用户回答** 确认或者否认含义
*   **处理** STT -> LLM分析意图 -> 如果用户确认停止那么退出；否则继续阶段2 台词对练环节

#### 5. 重新开始
*   **触发条件**：
    *   在阶段2 意图识别发现用户希望重新开始
*   **App开始向用户询问** 您确认重新开始吗？
*   **用户回答** 确认或者否认含义
*   **处理** STT -> LLM分析意图 -> 如果用户确认停止那么从头开始；否则继续阶段2 台词对练环节

## 技术约束
数据库 mysql5.7 PHP版本5.4 作为后端
前端使用 SAP + React模式开发
语音识别和文字转换使用豆包方案
前端注意界面逻辑分离，因为我们后续界面要做较大调整

### 豆包流式语音识别模型2.0
语音转文字
https://console.volcengine.com/speech/service/10038?AppID=<YOUR_APP_ID>
appid V2L_APPID

AccessToken .env V2L_ACCESS_TOKEN

Secret key .env V2L_SECRET_KEY

接入文档： api方式 https://www.volcengine.com/docs/6561/1354869?lang=zh
sdk方式 https://www.volcengine.com/docs/6561/1354869?lang=zh

### 语音合成大模型

https://console.volcengine.com/speech/service/10007?AppID=<YOUR_APP_ID>

appid L2V_APPID

AccessToken .env L2V_ACCESS_TOKEN

Secret key .env L2V_SECRET_KEY

api接入： https://www.volcengine.com/docs/6561/1257584
sdk接入：https://www.volcengine.com/docs/6561/79827?lang=zh

### 大语言模型
api key，放在.env LLM_API_KEY

curl https://api.deepseek.com/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer LLM_API_KEY" \
  -d '{
        "model": "deepseek-chat",
        "messages": [
          {"role": "system", "content": "You are a helpful assistant."},
          {"role": "user", "content": "Hello!"}
        ],
        "stream": false
      }'

